<!--
Version: 0.1; Sept 19th 2011
-->
<!DOCTYPE html>
<html>
    <head>
        <title>Forumview &mdash; Demo</title>
        <!-- <link rel="stylesheet" type="text/css" href="http://www.tayfeh.com/resources/css/reset.css" media="screen" />
        <link rel="stylesheet" type="text/css" href="http://www.tayfeh.com/resources/css/text.css" media="screen" /> -->
        <link rel="stylesheet" type="text/css" href="http://www.tayfeh.com/resources/css/960.css" media="screen" />
        <link rel="stylesheet" type="text/css" href="http://www.tayfeh.com/resources/colorpicker/colorPicker.css" media="screen" />
        <!--<link rel="stylesheet" type="text/css" href="http://www.tayfeh.com/resources/css/layout.css" media="screen" />
        <link rel="stylesheet" type="text/css" href="http://www.tayfeh.com/resources/css/nav.css" media="screen" /> -->
        
        <style type=text/css>
            body {
            
                margin: 0px;
                font-family: "lucida grande",tahoma,verdana,arial,sans-serif;
                line-height: 1.28;            
                font-size: 11px;
                color:     #333333;
                background: #ffffff;
                border-top: 7px solid #3b5998;
                /* padding: 0 0 40px; */
                }
            .comment_container{
                white-space: pre-wrap;      /* CSS3 */
                white-space: -moz-pre-wrap; /* Firefox */
                white-space: -pre-wrap;     /* Opera <7 */
                white-space: -o-pre-wrap;   /* Opera 7 */
                word-wrap: break-word;
                width:95%;
                display: block;
                float: left;
                padding: 5px 0;
                }
            .msg_txt_container{
                float: left;
                width: 100%;
                padding : 5px 0px 10px 0px;
                white-space: pre-wrap;      /* CSS3 */
                white-space: -moz-pre-wrap; /* Firefox */
                white-space: -pre-wrap;     /* Opera <7 */
                white-space: -o-pre-wrap;   /* Opera 7 */
                word-wrap: break-word;
                
                }
            #dialog-overlay {
                
                /* set it to fill the whil screen */
                width:100%;
                height:100%;
                
                /* transparency for different browsers */
                filter:alpha(opacity=50);
                -moz-opacity:0.5;
                -khtml-opacity: 0.5;
                opacity: 0.5;
                background:#000;
                
                /* make sure it appear behind the dialog box but above everything else */
                position:absolute;
                top:0; left:0;
                z-index:3000;
                
                /* hide it by default */
                display:none;
                }
            
            
            #dialog-box {
                
                width:100%;
                
                display:none;
                }
            
            #dialog-box .dialog-content {
                /* style the content */
                text-align:left;
                /* padding:10px; */
                /* margin:13px; */
                /*color:#666; */
                /* font-family:arial; */
                /* font-size:13px; */
                }
            
            a.buttond {
                
                /* styles for button */
                margin:10px auto 0 auto;
                text-align:center;
                display: block;
                width:50px;
                padding: 5px 10px 6px;
                color: #fff;
                text-decoration: none;
                font-weight: bold;
                line-height: 1;
                
                /* button color */
                background-color: #3b5998;
                
                /* css3 implementation :) */
                /* rounded corner */
                -moz-border-radius: 5px;
                -webkit-border-radius: 5px;
                
                /* drop shadow */
                -moz-box-shadow: 0 1px 3px rgba(0,0,0,0.5);
                -webkit-box-shadow: 0 1px 3px rgba(0,0,0,0.5);
                
                /* text shaow */
                text-shadow: 0 -1px 1px rgba(0,0,0,0.25);
                border-bottom: 1px solid rgba(0,0,0,0.25);
                position: relative;
                cursor: pointer;
                
                }
            
            a.buttond:hover {
                background-color: #1f4189;
                }

            a.buttoninline {
            color: white;
            background-color: #5B74A8;
            background-image: url("https://s-static.ak.facebook.com/rsrc.php/v1/yn/r/zHNGLEeoCs0.png");
            background-position: 0 -294px;
            background-repeat: no-repeat;
            border-color: #29447E #29447E #1A356E;
            border-style: solid;
            border-width: 1px;
            box-shadow: 0 1px 0 rgba(0, 0, 0, 0.1);
            cursor: pointer;
            display: inline-block;
            font-size: 11px;
            font-weight: bold;
            line-height: normal !important;
            padding: 2px 6px;
            text-align: center;
            text-decoration: none;
            vertical-align: top;
            white-space: nowrap;
                
/*              font-family: 'Lucida Grande',Arial,Helvetica,sans-serif;
                font-size:11px;
                margin:10px auto 10px auto;
                text-align:center;
                display: inline;
                width:70px;
                padding: 2px 4px 1px;
                color: #fff;
                text-decoration: none;
                font-weight: bold;
                line-height: 1;
                
                background-color: #AD2525;
                
                -moz-border-radius: 5px;
                -webkit-border-radius: 5px;
                
                -moz-box-shadow: 0 1px 3px rgba(0,0,0,0.5);
                -webkit-box-shadow: 0 1px 3px rgba(0,0,0,0.5);
                
                text-shadow: 0 -1px 1px rgba(0,0,0,0.25);
                border-bottom: 1px solid rgba(0,0,0,0.25);
                position: relative;
                cursor: pointer;
                 */
                }
            
            a.buttoninline:hover {
                background-color: #931F1F;
                }

            /* extra styling */
            #dialo-box {
            border-left: 1px solid #CCCCCC;
            }
            
            #dialog-box .dialog-content p {
                font-weight:700;
                margin: 5px 0;
                text-transform:capitalize;
                }
            
            #dialog-box .dialog-content h2 {
                margin: 0 0 3px;
                }
            
            #dialog-box .dialog-content ul {
                margin:10px 0 10px 20px;
                padding:0;
                height:50px;
                }
            .button {
                -moz-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.1);
                cursor: pointer;
                display: inline-block;
                font-family: 'Lucida Grande',Arial,Helvetica,sans-serif;
                font-size: 11px;
                font-weight: bold;
                height: 19px;
                outline: medium none;
                padding: 0.1em 0.5em;
                text-align: center;
                text-decoration: none;
                }
            .button:hover {
                text-decoration: none;
                }
            .button:active {
                position: relative;
                top: 1px;
                }
            .gray {
                background: -moz-linear-gradient(center top , #EEEEEE, #BBBBBB) repeat scroll 0 0 transparent;
                border: 1px solid #888888;
                color: #333333;
                }
            .gray:active {
                background: -moz-linear-gradient(center top , #BBBBBB, #EEEEEE) repeat scroll 0 0 transparent;
                color: #333333;
                }
            
            .post {float:left;width:100%;padding: 10px 0px 10px 10px; border-bottom: 1px solid #777777; font-family: "lucida grande",tahoma,verdana,arial,sans-serif; font-size:11px}
            #posts {width: 90%; margin:auto}
            .comment{background-color: #EDEFF4;
                border-bottom: 1px solid #E5EAF1;
                margin-top: 2px;
                float:left;
                width:100%;
                padding: 5px 5px 4px;}
            .full_name {
                color: #3B5998;
                text-decoration: none;
                font-weight: bold;
                float:left;
                }
            .dislike {
                width: 10px;
                height: 9px;
                background-position: -38px -407px;
                background-image: url(http://tayfeh.com/resources/fb_icons.png);
                background-repeat: no-repeat;
                display: inline-block;
                }
            .like {
                width: 10px;
                height: 9px;
                background-position: -27px -407px;
                background-image: url(http://static.ak.fbcdn.net/rsrc.php/v1/yp/r/P7K5KHuP9ni.png);
                background-repeat: no-repeat;
                display: inline-block;
                }
            .like_text {color: #3B5998;padding-left:10px; text-decoration:none}
            .dislike_text {color: #973B3B;padding-left:10px; text-decoration:none}
            .clickeditem {font-weight: bold;}
            .labelcontainers {
                width: 100%;
                padding: 0px 0px 0px 0px;
                }
            .categories{
                color: #999999;
                font-size: 9px;
                font-weight: bold;
                margin-top: 12px;
                display: block;
                line-height: 13px;
                min-height: 17px;
                padding: 5px 5px 0;
                text-transform: uppercase;
                }
            .label_item li{
                list-style-type:none;
                }
            .label_item{
                padding-left: 10px;
                }
            .labels {
                text-decoration:none;
                font-weight:normal;
                font-size:11px;
                background-color: #FFFFFF;
                display: block;
                line-height: 13px;
                min-height: 17px;
                padding: 3px 5px 0 0;
                text-transform: capitalize;
                color : #000000;
                }
            .labels:hover{
                cursor: pointer;
                background-color: #eff2f7;
                }
            .selectedlabel{
                display: block;
                line-height: 13px;
                min-height: 17px;
                padding: 5px 5px 0;
                text-transform: capitalize;
                font-weight:bold;
                background-color: #d8dfea;
                }
            .selectedlabel:hover{
                cursor: pointer;
                background-color: #d8dfea;
                }
            div.form-container { margin: 20px 0; padding: 0px; background-color: #FFF; border: 0;}

            div.form-container div.controlset {display: block; float:left; width: 100%; padding: 0.25em 0; border: 0;}

            div.form-container div.controlset label, 
            div.form-container div.controlset input,
            div.form-container div.controlset div { display: inline; float: left;}

            div.form-container div.controlset label { width: 140px; border: 0;}
            .datetextbox{
                display: none; 
                font-family: 'Lucida Grande',Arial,Helvetica,sans-serif; 
                font-size: 11px;
                }
                
            /* from http://teddevito.com/demos/calendar.css */
            .datepicker { border-collapse: collapse; border: 2px solid #999; position: absolute; z-index:200;}
            .datepicker tr.controls th { height: 22px; font-size: 11px; }
            .datepicker select { font-size: 11px; }
            .datepicker tr.days th { height: 18px; }
            .datepicker tfoot td { height: 18px; text-align: center; text-transform: capitalize; }
            .datepicker th, .datepicker tfoot td { background: #eee; font: 10px/18px Verdana, Arial, Helvetica, sans-serif; }
            .datepicker th span, .datepicker tfoot td span { font-weight: bold; }

            .datepicker tbody td { width: 24px; height: 24px; border: 1px solid #ccc; font: 11px/22px Arial, Helvetica, sans-serif; text-align: center; background: #fff; }
            .datepicker tbody td.date { cursor: pointer; }
            .datepicker tbody td.date.over { background-color: #99ffff; }
            .datepicker tbody td.date.chosen { font-weight: bold; background-color: #ccffcc; }
            
            .conditionsfixed{
                font-size: 11px;
                font-family: "lucida grande",tahoma,verdana,arial,sans-serif;
                line-height: 1.28;            
                margin: 5px 0 15px;
                vertical-align: middle;
            }
            .fonted{
                font-size: 11px;
                font-family: "lucida grande",tahoma,verdana,arial,sans-serif;
                line-height: 1.28;            
            }
        </style>
        
        <script src="http://code.jquery.com/jquery-latest.js"></script>
        <script src="http://www.tayfeh.com/resources/colorpicker/jquery.colorPicker.js" type="text/javascript"><!--mce:1--></script>
        <script src="http://teddevito.com/demos/cal.js" type="text/javascript"><!--mce:1--></script>
		<script src="http://jquery-json.googlecode.com/files/jquery.json-2.3.min.js" type="text/javascript"></script>
        <body>
            <div id="fb-root"></div>
            
            <div class="container_12">
                <div id="container_header" class="grid_12">
                    <h3 style="color:#3B5998">
                        <span>Labelize</span><br>
                        <span style="color:#000000">Facebook groups as you wish!</span>
                    </h3>
                </div>
                <!-- end .grid_12 -->
                <div class="clear"></div>
                <div id="container_leftpane" class="grid_3">
                    
                    <div class="box menu">
                        <div id="lable_container" class="labelcontainers">
                        </div>
                        <div id="menu_container_down" class="labelcontainers">
                        </div>
                    </div>
                    
                </div>
                <div id="container_rightpane" class="grid_7 suffix_2" style="padding-left: 9px; border-left: 1px solid rgb(204, 204, 204); margin-left: 0px;">
                    
                    <script type="text/javascript">
                        view_post = 'xxxxx';
                        function get_style(element, styleText){
                            if (!element){return{}}
                            function clean(st){
                                if (st.indexOf('-') != -1){
                                    st = st.substr(0, st.indexOf('-')) + st[st.indexOf('-') + 1].toUpperCase() + st.substr(st.indexOf('-') + 2)
                                    }
                                return st
                                }
                            if(element.style.getAttribute)
                            var s = element.style.getAttribute("cssText")? element.style.getAttribute("cssText").split(';') : '';
                            else
                            var s = element.getAttribute("style")? element.getAttribute("style").split(';') : '';
                            var t = {}
                            for (var i = 0 ; i < s.length ; i ++){
                                if (s[i].indexOf(':') != -1)
                                t[clean(s[i].split(':')[0])] = s[i].split(':')[1];
                                }
                            return t
                            }
                        function add_class(element, class_name){
                            element.className += " " + class_name;
                            }
                        function remove_class(element, class_name){
                            element.className = element.className.replace(class_name,'')
                            }
                        function set_style(element, styleText){
                            if (!element){return}
                            function clean(st){
                                var reExample = new RegExp("([A-Z])(?![A-Z])");
                                return st.replace(reExample, "-$1").toLowerCase();
                                }
                            var cur = get_style(element);
                            for (var i in styleText){
                                cur[i] = styleText[i];
                                }
                            var styleText = '';
                            for (var i in cur){
                                styleText = styleText + clean(i) + ':' + cur[i] + ';';
                                }
                            if(element.style.setAttribute)
                            element.style.setAttribute("cssText", styleText );
                            else
                            element.setAttribute("style", styleText );
                            }
                        
                        function addEvent(obj,type,fn) {
                            if (obj.addEventListener) {
                                obj.addEventListener(type,fn,false);
                                return true;
                                }
                            else if (obj.attachEvent) {
                                obj['e'+type+fn] = fn;
                                obj[type+fn] = function() { obj['e'+type+fn]( window.event );}
                                var r = obj.attachEvent('on'+type, obj[type+fn]);
                                return r;
                                }
                            else {
                                obj['on'+type] = fn;
                                return true;
                                }
                            }
                        
                        function aprox_time(t){
                            var weekday=new Array(7);
                            weekday[0]="Sunday";
                            weekday[1]="Monday";
                            weekday[2]="Tuesday";
                            weekday[3]="Wednesday";
                            weekday[4]="Thursday";
                            weekday[5]="Friday";
                            weekday[6]="Saturday";
                            var month=new Array(12);
                            month[0]="Jan";
                            month[1]="Feb";
                            month[2]="Mar";
                            month[3]="Apr";
                            month[4]="May";
                            month[5]="Jun";
                            month[6]="Jul";
                            month[7]="Aug";
                            month[8]="Sep";
                            month[9]="Oct";
                            month[10]="Nov";
                            month[11]="Dec";
                            var d = new Date();
                            var w = (d.getTime() - t.getTime())/60000;
                            return w < 1? 'Less than a minute ago':
                            w<3? 'A couple of minutes ago':
                            w < 60? (String(w).split('.')[0] + ' minutes ago') :
                            w < 120? 'about an hour ago' :
                            ((t.toDateString() == d.toDateString()) || (w < 60*8))?String(w/60).split('.')[0] + ' hours ago':
                            ((w < 2880) && ((t.getDay() == d.getDay() - 1) || ((t.getDay() == 6) && (d.getDay() == 0) )))? 'Yesterday':
                            (w < d.getDay() * 24 * 60)? weekday[t.getDay()]:
                            (d.getFullYear() == t.getFullYear())? month[t.getMonth()] + ' ' + t.getDate():
                            t.toLocaleDateString();
                            }
                        function create_post_comment(post_obj, data, user_list){
                            var comment = document.createElement('div');
                            comment.uid = data.id;
                            comment.updated_time = data.time;
                            var img = document.createElement('div');
                            img.innerHTML = '<a href="javascript:void(0)" style="margin-right:8px; width:32px;height:32px; float:left"><img style="width:32px; height:32px;border:none;" src="'+document.location.protocol +"//graph.facebook.com/" + data.fromid + '/picture" /></a>'
                            comment.appendChild(img.firstChild);
                            
                            var comment_details = document.createElement('div');
                            set_style(comment_details, {float:'right', width : '90%'});
                            var full_name = document.createElement('a');
                            full_name.href="http://www.facebook.com/profile.php?id=" + data.fromid;
                            full_name.target = "_blank";
                            add_class(full_name, 'full_name');
                            full_name.innerHTML = user_list[data.fromid];
                            comment_details.appendChild(full_name);
                            
                            var comment_text = document.createElement('div');
                            comment_text.innerHTML = data.text.replace(/\n/g, "<br/>");
                            add_class(comment_text, 'comment_container');
                            //set_style(comment_text, {display: 'block', float : 'left', width : '95%', padding : '5px 0px 5px 0px'});
                            comment_details.appendChild(comment_text);
                            
                            var like_container = document.createElement('div');
                            set_style(like_container, {width: '100%', float: 'left', padding : '5px 0px 0px 38px'});
                            
                            var time_date = document.createElement('span');
                            var created = new Date();
                            set_style(time_date, {color : 'gray'});
                            created.setTime(data.time*1000);
                            time_date.innerHTML = aprox_time(created);
                            comment.time_date = time_date;
                            like_container.appendChild(time_date);
                            comment.appendChild(comment_details);
                            var like_it = document.createElement('a');
                            like_it.innerHTML = data.user_likes? 'Unlike' : 'Like';
                            set_style(like_it, {paddingRight: '18px'});
                            like_it.href = "javascript:void(0)";
                            add_class(like_it, 'like_text');
                            like_container.appendChild(like_it);
                            
                            var like_icon = document.createElement('span');
                            add_class(like_icon, 'like');
                            like_container.appendChild(like_icon);
                            var how_many_like = document.createElement('span');
                            //how_many_like.href="javascript:void(0)";
                            add_class(how_many_like, 'like_text');
                            set_style(how_many_like, {color : '#000000'});
                            how_many_like.innerHTML = data.likes + ' people';
                            like_container.appendChild(how_many_like);
                            if (data.likes == 0){
                                set_style(how_many_like, {display : 'none'});
                                set_style(like_icon, {display : 'none'});
                                }
                            comment.how_many_like = how_many_like;
                            comment.like_icon = like_icon;
                            comment.like_it = like_it;
                            comment.appendChild(like_container);
                            
                            /*
                            var dislike_container = document.createElement('div');
                            set_style(dislike_container, {width: '100%', float: 'left', padding : '5px 0px 0px 38px'});
                            
                            var time_date_hide = document.createElement('span');
                            var created = new Date();
                            set_style(time_date_hide, {color : '#EDEFF4'});
                            created.setTime(data.time*1000);
                            time_date_hide.innerHTML = aprox_time(created);
                            dislike_container.appendChild(time_date_hide);
                            
                            var dislike_it = document.createElement('a');
                            // should be from our server, instead of: posts[i].comments.comment_list[j].user_likes?
                            dislike_it.innerHTML = data.user_likes? 'Undislike' : 'Disike';
                            set_style(dislike_it, {paddingRight: '10px'});
                            dislike_it.href = "javascript:void(0)";
                            add_class(dislike_it, 'dislike_text');
                            dislike_container.appendChild(dislike_it);
                            
                            
                            if (!data.user_likes)
                            {
                                
                                var dislike = document.createElement('span');
                                add_class(dislike, 'dislike');
                                dislike_container.appendChild(dislike);
                                var how_many_dislike = document.createElement('a');
                                how_many_dislike.href="javascript:void(0)";
                                add_class(how_many_dislike, 'dislike_text');
                                // form our server, instead of: posts[i].comments.comment_list[j].likes +
                                how_many_dislike.innerHTML = data.likes + ' people';
                                dislike_container.appendChild(how_many_dislike);
                                // from our server, instead of: posts[i].comments.comment_list[j].likes
                                if (data.likes == 0){
                                    set_style(how_many_dislike, {display : 'none'});
                                    set_style(dislike, {display : 'none'});
                                    }
                                
                                // hide dislike if it has been liked by the user
                                if (data.user_likes){
                                    set_style(dislike_it, {display : 'none'});
                                    set_style(how_many_dislike, {display : 'none'});
                                    set_style(dislike, {display : 'none'});
                                    }
                                // hide like if it has been disliked by the user
                                // should be added when connected to our server
                                
                                if (posts[i].comments.comment_list[j].user_dislikes){
                                    set_style(like_it, {display : 'none'});
                                    set_style(how_many_like, {display : 'none'});
                                    set_style(like, {display : 'none'});
                                    }
                                
                                
                                comment.appendChild(dislike_container);
                                } */
                            
                            add_class(comment, 'comment');
                            comment.update = function(data){
                                var created = new Date();
                                created.setTime(data.time*1000);
                                comment.time_date.innerHTML = aprox_time(created);
                                comment.like_it.innerHTML = data.user_likes? 'Unlike' : 'Like';
                                if (data.likes == 0){
                                    set_style(comment.how_many_like, {display : 'none'});
                                    set_style(comment.like_icon, {display : 'none'});
                                    return
                                    }
                                comment.how_many_like.innerHTML = data.likes + ' people';
                                set_style(comment.how_many_like, {display : ''});
                                set_style(comment.like_icon, {display : ''});
                                }
                            return comment
                            }
                        function fb_tools(args){
                            var tmp_this = this;
                            this.fb_login = function(){
                                FB.login(function(response) {
                                    tmp_this.fb_check_permission(response);
                                    }
                                , {perms:args.perms})
                                }
                            addEvent(document.getElementById(args.connect_button),'click',this.fb_login)
                            this.fb_check_permission = function(response){
                                if (response.perms){
                                    var perm_ok = true;
                                    for (var i = 0; i < args.perms.split(',').length; i++){
                                        if (response.perms.indexOf(args.perms.split(',')[i].replace(/\ /g, "")) == -1){perm_ok = false}
                                        }
                                    }else{var perm_ok = false}
                                if (perm_ok){
                                    set_style(document.getElementById(args.connect_button), {display : 'none'});
                                    args.init();
                                    return
                                    }
                                set_style(document.getElementById(args.connect_button), {display : 'inline-block'});
                                }
                            }
                        
                        function load_posts(args){
                            lpp = 20;
                            var d = new Date();
                            if (!args.to){
                                args.to = Math.round(d.getTime() / 1000);
                                }
                            FB.api('/me/groups', {}, function(response) {
                                var groups = ''
                                for (var i = 0 ; i < response.data.length; i++){
                                    groups = groups + (groups.length == 0? String(response.data[i].id): (',' + String(response.data[i].id)))
                                    }
                                if (args.post_id){
                                    var posts = FB.Data.query('SELECT source_id, post_id, message,updated_time,created_time,actor_id,action_links,attachment,comments,likes,tagged_ids FROM stream WHERE post_id="{0}"', args.post_id);
                                    var comments = FB.Data.query('SELECT fromid from comment where post_id in (select post_id from {0})', posts);
                                    var users = FB.Data.query('SELECT uid, name FROM user WHERE uid in (select actor_id from {0}) OR uid in (select fromid from {1})', posts, comments);
                                    wait_on = [posts, comments, users]
                                    }
                                else{
                                    if (args.gid.length && !/[^\d]/.test(args.gid)){
                                        if (args.posts_list){
                                            var posts = FB.Data.query('SELECT source_id, post_id, message,updated_time,created_time,actor_id,action_links,attachment,likes,tagged_ids FROM stream WHERE post_id IN ({0}) ORDER BY updated_time DESC',args.posts_list);
                                            }
                                        else{
                                            var posts = FB.Data.query('SELECT source_id, post_id, message,updated_time,created_time,actor_id,action_links,attachment,likes,tagged_ids FROM stream WHERE updated_time<{2} and source_id={0} ORDER BY updated_time DESC LIMIT {1}',args.gid, lpp, args.to);
                                            }
                                        var users = FB.Data.query('SELECT uid, name FROM user WHERE uid in (select actor_id from {0})', posts);
                                        wait_on = [posts, users]
                                        }
                                    else
                                    {
                                        var group = FB.Data.query('select gid from group where gid IN ('+groups+') AND email="'+args.gid+'@groups.facebook.com"','');
                                        if (args.posts_list){
                                            var posts = FB.Data.query('SELECT source_id, post_id, message,updated_time,created_time,actor_id,action_links,attachment,likes,tagged_ids FROM stream WHERE post_id IN ({0}) ORDER BY updated_time DESC',args.posts_list);
                                            }
                                        else{
                                            var posts = FB.Data.query('SELECT source_id, post_id, message,updated_time,created_time,actor_id,action_links,attachment,likes,tagged_ids FROM stream WHERE source_id IN (select gid from {0}) and updated_time<{2} ORDER BY updated_time DESC LIMIT {1}',group, lpp, args.to);
                                            }
                                        var users = FB.Data.query('SELECT uid, name FROM user WHERE uid in (select actor_id from {0})', posts);
                                        wait_on = [group, posts, users]
                                        }
                                    }
                                FB.Data.waitOn(wait_on, function() {
                                    if (posts.value.length > 0) {window.source_id = posts.value[0].source_id;}else{window.source_id=null; alert('Not available.'); switch_posts_to_page(window.last_fine_post_page); return}
                                    if ((window.obj_load) && (!window.load_obj_initialized)){window.obj_load(window.source_id); window.load_obj_initialized = true;}
                                    if (posts.value.length > 0){var from_time = posts.value[posts.value.length-1].updated_time; var to_time = posts.value[0].updated_time}else{var updated_time = null; var to_time = null}
                                    args.onload(posts.value, users.value, from_time, to_time);
                                    });
                                return
                                });
                            }
                        
                        function create_label_iconed(txt, uid, shared, onclick){
                            var li = document.createElement('li');
                            li.uid = uid;
                            li.txt = txt;
                            div1 = document.createElement('div');
                            set_style(div1,{float: 'left'});
                            a1 = document.createElement('a');
                            a1.href = 'javascript:void(0)';
                            img1 = document.createElement('img');
                            img1.width = 15;
                            img1.height = 16;
                            if (shared == 'shared') {
                                img1.src = "http://tayfeh.com/resources/img/Shareit_abled.png";
                            } else {
                                img1.src = "http://tayfeh.com/resources/img/Shareit_disabled.png";
                            }
                            a1.appendChild(img1);
                            div1.appendChild(a1);
                            li.appendChild(div1);
                            a2 = document.createElement('a');
                            a2.href = "javascript:void(0)";
                            a2.innerHTML = txt;
                            add_class(a2, 'labels');
                            li.appendChild(a2);

                            li.add_child = function(t_txt, t_uid, t_onclick){
                                if (!li.cn){var c = document.createElement('ul'); li.appendChild(c); li.cn = c; add_class(c, 'label_item');}
                                var child = create_label_iconed(t_txt, t_uid, 'personal', t_onclick);
                                li.cn.appendChild(child);
                                }
                            addEvent(a1, 'click', function(){
                                var okay = false;
                                if (this.getElementsByTagName('img')[0].src == 'http://tayfeh.com/resources/img/Shareit_disabled.png'){
                                    var label2update = {};
                                    label2update.label_id = this.parentNode.parentNode.uid;
                                    label2update.shared = 1;
                                    label2update.personal = 1;
                                    $.post("/update_label",label2update,
                                        function(result) {
                                            if (result["type"]=="ok"){
                                                okay = true; 
                                            } else {
                                                okay = false;
                                            }});
                                     //if (okay) {
                                         this.getElementsByTagName('img')[0].src = "http://tayfeh.com/resources/img/Shareit_abled.png"
                                     //    } else {
                                     //        alert('problem in database connection, please try later.');
                                     //    }
                                } else {
                                    var label2update = {};
                                    label2update.label_id = this.parentNode.parentNode.uid;
                                    label2update.shared = 0;
                                    label2update.personal = 1;                                    
                                    $.post("/update_label",label2update,
                                        function(result) {
                                            if (result["type"]=="ok"){
                                                okay = true; 
                                            } else {
                                                okay = false;
                                            }});
                                     //if (okay) {
                                         this.getElementsByTagName('img')[0].src = "http://tayfeh.com/resources/img/Shareit_disabled.png"
                                     //    } else {
                                     //        alert('problem in database connection, please try later.');
                                     //    }
                                }
                                    
                            });
                            addEvent(a2, 'click', onclick);
                            return li
                            }
                        function create_label(txt, uid, onclick){
                            var li = document.createElement('li');
                            li.uid = uid;
                            li.txt = txt;
                            li.innerHTML = '<a href="javascript:void(0)">' + txt + '</a>';
                            add_class(li.getElementsByTagName('a')[0], 'labels');
                            li.add_child = function(t_txt, t_uid, t_onclick){
                                if (!li.cn){var c = document.createElement('ul'); li.appendChild(c); li.cn = c; add_class(c, 'label_item');}
                                var child = create_label(t_txt, t_uid, t_onclick);
                                li.cn.appendChild(child);
                                }
                            addEvent(li.getElementsByTagName('a')[0], 'click', onclick);
                            return li
                            }                            
                        function create_post(data, user_list, onclick){
                            var container = document.createElement('div');
                            container.post_id = data.post_id;
                            var msg = document.createElement('div');
                            set_style(msg, {paddingLeft: '60px', height : '60px', backgroundImage : 'url("' + document.location.protocol +"//graph.facebook.com/" + data.actor_id + '/picture")', backgroundRepeat : 'no-repeat'});
                            container.appendChild(msg);
                            add_class(container, 'post');
                            
                            var div = document.createElement('div');
                            
                            var full_name = document.createElement('a');
                            full_name.href="http://www.facebook.com/profile.php?id=" + data.actor_id;
                            full_name.target = "_blank";
                            add_class(full_name, 'full_name');
                            full_name.innerHTML = user_list[data.actor_id];
                            div.appendChild(full_name);
                            
                            var msg_txt = document.createElement('div');
                            add_class(msg_txt, 'msg_txt_container');
                            set_style(msg_txt, {cursor:(onclick ? 'pointer' : 'auto')});
                            addEvent(msg_txt, 'click', function(){
                                if (onclick)
                                onclick(data.post_id);
                                });
                            msg_txt.innerHTML = data.message.replace(/\n/g, "<br/>");
                            div.appendChild(msg_txt);
                            msg.appendChild(div);
                            var like_container = document.createElement('div');
                            set_style(like_container, {width: '100%', float: 'left', padding : '5px 0px 5px 0px'});
                            
                            var time_date = document.createElement('span');
                            var created = new Date();
                            set_style(time_date, {color : 'gray'});
                            created.setTime(data.updated_time*1000);
                            time_date.innerHTML = aprox_time(created);
                            like_container.appendChild(time_date);
                            var like_it = document.createElement('a');
                            like_it.innerHTML = data.likes.user_likes? 'Unlike' : 'Like';
                            
                            set_style(like_it, {paddingRight: '18px'});
                            like_it.href = "javascript:void(0)";
                            add_class(like_it, 'like_text');
                            like_container.appendChild(like_it);
                            
                            var like_icon = document.createElement('span');
                            add_class(like_icon, 'like');
                            like_container.appendChild(like_icon);
                            var how_many_like = document.createElement('a');
                            how_many_like.href="javascript:void(0)";
                            add_class(how_many_like, 'like_text');
                            how_many_like.innerHTML = data.likes.count + ' people';
                            like_container.appendChild(how_many_like);
                            if (data.likes.count == 0){
                                set_style(how_many_like, {display : 'none'});
                                set_style(like_icon, {display : 'none'});
                                }
                            container.how_many_like = how_many_like;
                            container.like_counter = data.likes.count;
                            container.like_icon = like_icon;
                            container.like_it = like_it;
                            div.appendChild(like_container);
                            container.time_date = time_date;
                            container.updated_time = data.updated_time;
                            addEvent(like_it, 'click', function(){
                                if (this.innerHTML.indexOf('Like') != -1){
                                    FB.api('/' + container.post_id + '/likes', 'post', {}, function(response) {
                                        if (!response || response.error) {
                                            } else {
                                            container.like_it.innerHTML = 'Unlike';
                                            set_style(container.how_many_like, {display : ''});
                                            set_style(container.like_icon, {display : ''});
                                            container.like_counter = parseInt(container.like_counter) + 1;
                                            container.how_many_like.innerHTML =  container.like_counter + ' people';
                                            }
                                        });
                                    return
                                    }
                                FB.api('/' + container.post_id + '/likes', 'delete', {}, function(response) {
                                    if (!response || response.error) {
                                        } else {
                                        container.like_counter = parseInt(container.like_counter) - 1;
                                        container.how_many_like.innerHTML =  container.like_counter + ' people';
                                        if (container.like_counter == 0){
                                            set_style(container.how_many_like, {display : 'none'});
                                            set_style(container.like_icon, {display : 'none'});
                                            }
                                        container.like_it.innerHTML = 'Like';
                                        }
                                    });
                                });
                            div.comments = {}
                            if (data.comments)
                            for (var j = 0; j < data.comments.comment_list.length; j++){
                                var comment = create_post_comment(div, data.comments.comment_list[j], user_list);
                                div.appendChild(comment);
                                div.comments[comment.uid] = comment;
                                }
                            container.update = function(data, user_list){
                                container.updated_time = data.updated_time;
                                if (data.comments)
                                for (var j = 0; j < data.comments.comment_list.length; j++){
                                    if (data.comments.comment_list[j].id in div.comments){
                                        div.comments[data.comments.comment_list[j].id].update(data.comments.comment_list[j], user_list);
                                        }else{
                                        var comment = create_post_comment(div, data.comments.comment_list[j], user_list);
                                        div.appendChild(comment);
                                        div.comments[comment.uid] = comment;
                                        }
                                    }
                                container.like_it.innerHTML = data.likes.user_likes? 'Unlike' : 'Like';
                                container.how_many_like.innerHTML = data.likes.count + ' people';
                                if (data.likes.count == 0){
                                    set_style(container.how_many_like, {display : 'none'});
                                    set_style(container.like_icon, {display : 'none'});
                                    }
                                else{
                                    set_style(container.how_many_like, {display : ''});
                                    set_style(container.like_icon, {display : ''});
                                    
                                    }
                                var created = new Date();
                                created.setTime(data.updated_time*1000);
                                container.time_dateinnerHTML = aprox_time(created);
                                
                                }
                            
                            return container
                            }
                        function display_posts(args){
                            this.clear_container = function(){
                                if (this.posts_container){while (this.posts_container.firstChild){this.posts_container.removeChild(this.posts_container.firstChild)}}
                                }
                            this.destroy = function(){
                                if (this.posts_container){
                                    this.clear_container();
                                    this.posts_container.updated_time = 0;
                                    }
                                this.posts_list={}
                                }
                            this.posts_container = args.container;
                            this.update = function(posts, users){
                                this.posts_container.updated_time = 0;
                                if (!this.posts_list){this.posts_list = {};}
                                user_list = {}
                                for (var i = 0; i < users.length; i++){
                                    user_list[users[i].uid] = users[i].name;
                                    }
                                for (var i = 0; i < posts.length; i++){
                                    if (posts[i].post_id in this.posts_list){
                                        this.posts_list[posts[i].post_id].update(posts[i], user_list);
                                        for (var k = (this.posts_container.childNodes.length - 1); k >= 0; k--){
                                            if (posts[i].updated_time > this.posts_container.childNodes[k].updated_time){
                                                this.posts_container.insertBefore(this.posts_list[posts[i].post_id], this.posts_container.childNodes[k]);
                                                }
                                            }
                                        }else{
                                        var post = create_post(posts[i], user_list, args.onclick);
                                        if (posts[i].updated_time > this.posts_container.updated_time){
                                            this.posts_container.insertBefore(post, this.posts_container.firstChild);
                                            this.posts_container.updated_time = posts[i].updated_time;
                                            }else{
                                            this.posts_container.appendChild(post);
                                            }
                                        this.posts_list[posts[i].post_id] = post;
                                        }
                                    }
                                }
                            this.stop_timer = function(){
                                if (this._handler) try{clearInterval(this._handler);}catch(e){}
                                }
                            this.timer = function(sec, func){
                                this.stop_timer();
                                var chars = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";
                                var string_length = 8;                                var randomstring = '';
                                for (var i=0; i<string_length; i++) {
                                    var rnum = Math.floor(Math.random() * chars.length);
                                    randomstring += chars.substring(rnum,rnum+1);
                                    }                                var tmp = this;
                                this.id= this.id? this.id : randomstring;
                                if (!window.display_post_time){window.display_post_time = {}}
                                window.display_post_time[this.id] = [func, tmp];
                                this._handler = setInterval("if (window.display_post_time['" + this.id + "']) {window.display_post_time['" + this.id + "'][0](window.display_post_time['" + this.id + "'][1])}else{}", sec)
                                }
                            }
                        function switch_posts_to_page(n){
                            var read_from_list = false;
                            if (n == 0){
                                window.to_date = null;
                                }
                            if ((n > window.post_show.now_displaying) && (n!=0)){
                                window.to_date = window.from_date;
                                //window.from_date = null;
                                if (n!=1){
                                    tmp_read_from_list = ''
                                    for (var i in window.post_show.posts_list){
                                        tmp_read_from_list = tmp_read_from_list==''? ('"' + i + '"') : ('"' + i + '",' + tmp_read_from_list);
                                        }
                                    if (window.posts_list){
                                        window.posts_list.push(tmp_read_from_list)
                                        }
                                    else{
                                        window.posts_list = [tmp_read_from_list]
                                        }
                                    }
                                }
                            if ((n < window.post_show.now_displaying) && (n!=0)){
                                //window.from_date = window.to_date;
                                //window.to_date = null;
                                read_from_list = window.posts_list.pop()
                                }
                            window.post_show.now_displaying = n;
                            window.post_show.timer(20000, function(){
                                load_posts({posts_list: read_from_list, to: (window.post_show.now_displaying == 0? null : window.to_date), gid : document.location.pathname.split('/').length > 1? document.location.pathname.split('/')[1]
                                    : '', onload : function(posts, users, from_date, to_date){
                                        window.last_fine_post_page = window.post_show.now_displaying;
                                        window.post_show.update(posts, users); window.from_date = from_date; window.to_date = to_date}});
                                });
                            load_posts({posts_list: read_from_list, to: window.to_date, gid : document.location.pathname.split('/').length > 1? document.location.pathname.split('/')[1] : '', onload : function(posts, users, from_date, to_date){
                                    window.last_fine_post_page = window.post_show.now_displaying;
                                    window.post_show.destroy(); window.to_date = to_date; window.from_date = from_date; window.post_show.update(posts, users);}});
                            
                            }
                        function init(){
                            post_show = new display_posts({container: document.getElementById('posts'), onclick : function(post_id){
                                    set_style(document.getElementById('posts_container'), {display: 'none'});
                                    set_style(document.getElementById('post_comment_container'), {display: 'block'});
                                    window.forum = new display_posts({container: document.getElementById('post_comment')});
                                    load_posts({post_id : post_id, gid : document.location.pathname.split('/').length > 1? document.location.pathname.split('/')[1] : '', onload : function(posts, users){window.forum.update(posts, users);}});
                                    window.forum.timer(20000, function(){
                                        load_posts({post_id : post_id, gid : document.location.pathname.split('/').length > 1? document.location.pathname.split('/')[1] : '', onload : function(posts, users){window.forum.update(posts, users);}});
                                        })
                                    }
                                });
                            switch_posts_to_page(0);
                            }
                        
                        window.fbAsyncInit = function() {
                            FB.init({
                                appId  : '246575252046549',
                                status : true, // check login status
                                cookie : true, // enable cookies to allow the server to access the session
                                xfbml  : true  // parse XFBML
                                })
                            FBtools = new fb_tools({connect_button: 'fb_connect_button', init : init, perms:'publish_stream, read_stream, user_groups'})
                            FB.Event.subscribe("auth.login", function(response) {
                                FBtools.fb_check_permission(response);
                                });
                            FB.getLoginStatus(function(response) {
                                FBtools.fb_check_permission(response);
                                if (response.session) {
                                    // logged in and connected user, someone you know
                                    } else {
                                    // no user session available, someone you dont know
                                    }
                                });
                            };
                        
                        (function() {
                            var e = document.createElement('script');
                            e.src = document.location.protocol + '//connect.facebook.net/en_US/all.js';
                            e.async = true;
                            document.getElementById('fb-root').appendChild(e);
                            }());
                        
                        //Popup dialog
                        function popup(message) {
                            var maskWidth = $(window).width();
                            var windowHeight = $(window).height();
                            
                            // calculate the values for center alignment
                            var dialogTop =  (windowHeight/2) - ($('#dialog-box').height()/2);
                            var dialogLeft = (maskWidth/2) - ($('#dialog-box').width()/2);
                            
                            // assign values to the overlay and dialog box
                            $('#dialog-overlay').css({height:maskHeight, width:maskWidth}).show();
                            $('#dialog-box').css({top:dialogTop, left:dialogLeft}).show();
                            
                            // display the message
                            $('#dialog-message').html(message);
                            };
                        
                        function create_tag(id,txt,logo){
                            if (logo != ''){
                                //<a href="javascript:void(0)"><img src="http://tayfeh.com/resources/img/Not_shared.png" width="15" height="16" alt="Share this lable" style="margin-right: 5px;"/></a>
                                var icon_div = document.createElement('div');
                                set_style(icon_div,{float: 'left'});
                                var icon_pic = document.createElement('img');
                                icon_pic.src = logo;
                                set_style(icon_pic,{"margin-right": '5px'});
                                icon_div.appendChild(icon_pic);
                            }
                            var menu_div = document.createElement('div');
                            //menu_div.uid = id;
                            menu_div.id = id;
                            menu_div.innerHTML = txt;
                            add_class(menu_div, 'categories');
                            if (logo != ''){
                                menu_div.appendChild(icon_div);
                            }
                            document.getElementById('lable_container').appendChild(menu_div);
                        };
                        
                        function create_tag_linked(id,txt,link){
                            var menu_div = document.createElement('div');
                            menu_div.uid = id;
                            //menu_div.innerHTML = txt;
                            add_class(menu_div, 'categories');
                            var a = document.createElement('a');
                            a.innerHTML = txt;
                            a.setAttribute('href', link);
                            a.setAttribute('style', "text-decoration:none;");
                            menu_div.appendChild(a);
                            document.getElementById('lable_container').appendChild(menu_div);
                        };
                        
                        function create_condition_if(){
                            var fconditions = document.getElementById('conditions_if');
                            var tag, tagtx;
                            
                            tag = document.createElement('div');    
                            tag.setAttribute('class', 'conditionsfixed');
                            tag.setAttribute('style', 'border-top: 1px solid rgb(204, 204, 204); padding-top: 5px; margin-top: 10px;');

                            tagtx = document.createElement('a');
                            tagtx.setAttribute('id', 'optionsbutton');
                            tagtx.setAttribute('class', 'fonted');
                            tagtx.setAttribute('style', 'text-decoration:none; font-weight: 700; text-transform: capitalize;');
                            tagtx.setAttribute('href', '#');
                            tagtx.innerHTML='more options...';
                            tagtx.onclick = function(){
                                //alert('clicked');
                                if (this.innerHTML == 'more options...'){
                                    this.innerHTML='cancel options...';
                                    set_style(document.getElementById('conditions_fixed'),{display: 'block'});
                                    set_style(document.getElementById('conditions'),{display: 'block'});
                                } else {
                                    this.innerHTML='more options...';
                                    set_style(document.getElementById('conditions_fixed'),{display: 'none'});
                                    set_style(document.getElementById('conditions'),{display: 'none'});                                        
                                }
                            }
                            
                            tag.appendChild(tagtx);
                            fconditions.appendChild(tag);
                            
                            
                        }
                            
                        function create_condition_fix(){
                            
                            var fconditions = document.getElementById('conditions_fixed');
                            var tag, tagtx, taglist, likes, likelist, likestx, likesl, likesl2, comments, commentlist, commentstx, commentsl, commentsl2;
                            var dates, datesl2, datestx, datelist, datesl, attachs, attachsl, attachsin, timelist;
                            
                            tag = document.createElement('div');    
                            tag.setAttribute('class', 'conditionsfixed');
                            //tag.setAttribute('style', 'border-top: 1px solid rgb(204, 204, 204); padding-top: 5px; margin-top: 10px;');

                            tagtx = document.createElement('p');
                            tagtx.setAttribute('class', 'fonted');
                            tagtx.innerHTML='Apply label with the following filters';

                            taglist = document.createElement('select');
                            taglist.setAttribute('id', 'taglist');                                
                            taglist.setAttribute('class', 'fonted');
                            taglist.setAttribute('style', 'margin-left: 5px;');

                            theOption = document.createElement("OPTION");
                            theText = document.createTextNode("all options (AND)");
                            theOption.appendChild(theText);
                            theOption.setAttribute("value","and");
                            taglist.appendChild(theOption);

                            theOption = document.createElement("OPTION");
                            theText = document.createTextNode("any option (OR)");
                            theOption.appendChild(theText);
                            theOption.setAttribute("value","or");
                            taglist.appendChild(theOption);                                
                            
                            tagtx.appendChild(taglist);
                            tag.appendChild(tagtx);
                            fconditions.appendChild(tag);

                            ///
                            dates = document.createElement('div');    
                            dates.setAttribute('class', 'conditionsfixed');
                            
                            datesl = document.createElement('label');
                            datesl.setAttribute('for', 'likelist');
                            datesl.setAttribute('style', 'margin-right: 5px;');
                            datesl.innerHTML='If it has been posted';


                            datelist = document.createElement('select');
                            datelist.setAttribute('id', 'datelist');                                
                            datelist.setAttribute('class', 'fonted');
                            datelist.setAttribute('style', 'margin-right: 5px;');

                            theOption = document.createElement("OPTION");
                            theText = document.createTextNode("before");
                            theOption.appendChild(theText);
                            theOption.setAttribute("value","true");
                            datelist.appendChild(theOption);

                            theOption = document.createElement("OPTION");
                            theText = document.createTextNode("after");
                            theOption.appendChild(theText);
                            theOption.setAttribute("value","false");
                            datelist.appendChild(theOption);


                            datestx = document.createElement('input');
                            datestx.setAttribute('type', 'text');
                            datestx.setAttribute('id', 'datetext');
                            datestx.setAttribute('size', '10'); 
                            datestx.setAttribute('maxlength', '10');
                            datestx.setAttribute('style', 'margin-right: 5px;');
                            datestx.setAttribute('class', 'fonted');
                            $(datestx).simpleDatepicker({ startdate: 2007 , y: -200});
                            
                            timelist = document.createElement('select');
                            timelist.setAttribute('id', 'timelist');                                
                            timelist.setAttribute('class', 'fonted');
                            timelist.setAttribute('style', 'margin-right: 5px;');

                            theOption = document.createElement("OPTION");
                            theText = document.createTextNode("");
                            theOption.appendChild(theText);
                            theOption.setAttribute("value",25);
                            timelist.appendChild(theOption);

                            for (var d=0;d<=23;d++){
                                theOption = document.createElement("OPTION");
                                theText = document.createTextNode(d+":00");
                                theOption.appendChild(theText);
                                theOption.setAttribute("value",d);
                                timelist.appendChild(theOption);
                            }
                            
                            datesl2 = document.createElement('label');
                            datesl2.setAttribute('for', 'likelist');
                            datesl2.innerHTML='(date and time).';

                            dates.appendChild(datesl);
                            dates.appendChild(datelist);
                            dates.appendChild(datestx);
                            dates.appendChild(timelist);
                            dates.appendChild(datesl2);
                            fconditions.appendChild(dates);

                            
                            attachs = document.createElement('div');    
                            attachs.setAttribute('class', 'conditionsfixed');

                            attachsin = document.createElement('input');
                            attachsin.setAttribute('id', 'hasattachments');
                            attachsin.setAttribute('type', 'checkbox');
                            attachs.appendChild(attachsin);
                            
                            attachsl = document.createElement('label');
                            attachsl.setAttribute('for', 'hasattachments');
                            attachsl.innerHTML='If it has attachments';
                            attachs.appendChild(attachsl);

                            fconditions.appendChild(attachs);    
                        }
                        
                        function create_condition(){
                            var newcond = document.createElement('div');
                            var conditions = document.getElementById('conditions');

                            var button, condlist, textbox;

                            // add rule button
                            button = document.createElement('a');                                            
                            button.setAttribute('class', 'buttoninline'); 
                            button.setAttribute('href', '#');
                            button.innerHTML='more';
                            button.onclick = function () {
                                    if (this.innerHTML=='more'){
                                        set_style(this.parentNode.getElementsByTagName("select")[0],{display: 'inline'});
                                        set_style(this.parentNode.getElementsByTagName("input")[0],{display: 'inline'});
                                        this.innerHTML='delete';
                                        create_condition();
                                    } else {
                                        //this.innerHTML='Add rule';
                                        this.parentNode.parentNode.removeChild(this.parentNode);
                                    }
                                    }
                                    
                            //condlis                                
                            condlist = document.createElement('select');
                            condlist.setAttribute('class', 'fonted');
                            condlist.setAttribute('style', 'display: none; margin-left: 5px; margin-right: 5px;');

                            theOption = document.createElement("OPTION");
                            theText = document.createTextNode("Who posted the messge");
                            theOption.appendChild(theText);
                            theOption.setAttribute("value",1);
                            condlist.appendChild(theOption);

                            theOption = document.createElement("OPTION");
                            theText = document.createTextNode("Who is mentioned");
                            theOption.appendChild(theText);
                            theOption.setAttribute("value",2);
                            condlist.appendChild(theOption);

                            theOption = document.createElement("OPTION");
                            theText = document.createTextNode("What is in the text");
                            theOption.appendChild(theText);
                            theOption.setAttribute("value",31);
                            condlist.appendChild(theOption);

                            theOption = document.createElement("OPTION");
                            theText = document.createTextNode("What is not in the text");
                            theOption.appendChild(theText);
                            theOption.setAttribute("value",32);
                            condlist.appendChild(theOption);

                            // textbox
                            textbox = document.createElement('input');  
                            textbox.setAttribute('type', 'text');
                            textbox.setAttribute('size', '25'); 
                            textbox.setAttribute('maxlength', '40');
                            textbox.setAttribute('class', 'datetextbox');
                                                            
                            
                            //appending the elements
                            newcond.setAttribute("style", "margin-bottom: 5px;");
                            conditions.appendChild(newcond);
                            newcond.appendChild(button);
                            newcond.appendChild(condlist);
                            newcond.appendChild(textbox);
                        };
                                
                        //jQuery: DB connection and the Menu
                        
                        window.obj_load = function(source_id){
                            
                            $(document).ready(function(){
                                window.admin = true;
                                window.global = true;
                                window.owner = false;
                                
                                $.getJSON("/get_labels?obj_id="+source_id, function(data) {
                                    if (data.type == 'ok'){
                                        if (window.global) {
                                            pv = create_tag_linked('info_personal','Personal View',"#");
                                            }
                                        else{
                                            create_tag_linked('info_global','Global View',"#");
                                            }
                                        create_tag('labels_cat1','My General Labels','http://tayfeh.com/resources/img/My.png');
										
										if (FB._session.uid == 'XXX_VIEW_ID_XXX') {
											if (XXX_ADMIN_XXX) {
												if ('XXX_OBJ_ID_XXX' != 'XXX_VIEW_ID_XXX') {
													create_tag('labels_cat2','Personal lables for here','http://tayfeh.com/resources/img/My_ThisGroup.png');
												}
												if ('XXX_KIND_XXX' == 'group' || 'XXX_KIND_XXX' == 'page') {
													create_tag('labels_cat3','XXX_KIND_XXX'+'\'s Labels','http://tayfeh.com/resources/img/Group.png');
												}
											} else {
												create_tag('labels_cat2','My Labels for This '+'XXX_KIND_XXX','http://tayfeh.com/resources/img/My_ThisGroup.png');
												if ('XXX_KIND_XXX' == 'group' || 'XXX_KIND_XXX' == 'page') {
													create_tag('labels_cat3','XXX_KIND_XXX'+'\'s Labels','http://tayfeh.com/resources/img/Group.png');
												} else {
													create_tag('labels_cat3','XXX_VIEW_ID_XXX'+'\'s Labels','http://tayfeh.com/resources/img/Group.png'); //?? instead of VIED_ID we should put VIUE_ID->name
												}
											}
											
										}
										//if ("XXX_KIND_XXX" == "group" || "XXX_KIND_XXX" == "page") {
										//	create_tag('my_dedicated_labels','My Labels for This '+'XXX_KIND_XXX','http://tayfeh.com/resources/img/My_ThisGroup.png');
										//	create_tag('here_labels','XXX_KIND_XXX'+'\'s Labels','http://tayfeh.com/resources/img/Group.png');
										//}
                                        
                                        list = data.data;
                                        window.labels = {}
                                        var label_list = document.createElement('ul');
                                        label_list.id = 'lable_container_ul'
                                        add_class(label_list, 'label_item');
                                        for (var i in list){
                                            if (list[i].parent == "0"){
                                                var l = create_label_iconed(list[i].name, i, list[i].shared, function(){alert('click')})
                                                window.labels[i] = l;
                                                label_list.appendChild(l)
                                                }
                                            }
										for (var i in list){
                                            if (list[i].parent in window.labels){
                                                window.labels[list[i].parent].add_child(list[i].name, i, function(){alert('click')});
                                                }
                                            }
                                        document.getElementById('labels_cat1').appendChild(label_list);

                                        var menu_add_label = create_label('Add label','creat_label', function(){
                                            set_style(document.getElementById('dialog-box'), {display : 'block'});
                                            set_style(document.getElementById('posts_container'), {display : 'none'});
                                            set_style(document.getElementById('post_comment_container'), {display : 'none'});
                                            var s = '<div><h2> New Label </h2><p>Please enter a name for the new label: </p>';
                                            s += '<input type="text" name="name_label" size="26" maxlength="25" value="" id="name_label" title="Name of the label" class="conditionsfixed"/>';
                                            s += '<p>Please enter a description: </p><textarea id="description_label" rows="2" cols="50" class="conditionsfixed"></textarea>';
                                            s += '<p id="options_row">Nest label under: <select name="list_labels" id="list_labels" class="conditionsfixed"><option value="0">Root</option>';
                                            for (var i in window.labels){
                                                s += '<option value="'+window.labels[i].txt+'">'+window.labels[i].txt+'</option>';
                                                }
                                            s += '</select>';
                                            s += '</p><div class="form-container"><form action="#" method="post"><div class="controlset">';
                                            s += '<label for="color1"><strong>Choose Label'+"'"+'s color</strong></label> <input id="color1" type="text" name="color1" value="#333399" />';
                                            s += '</div></form></div><p>&nbsp;</p>';
                                            s += '<div id="conditions_container">';
                                            s += '<div id="conditions_if"></div>'
                                            s += '<div id="conditions_fixed" style="display: none;"></div>'
                                            s += '<div id="conditions" style="display: none;"></div>'
                                            s += '</div></div>';
                                            document.getElementById('dialog-message').innerHTML = s;
                                            $('#color1').colorPicker();
                                            
                                            if (XXX_ADMIN_XXX) {
                                                p = document.getElementById('options_row');
                                                l1 = document.createElement('label');
                                                l1.setAttribute('style', 'margin-left: 15px;');
                                                theText = document.createTextNode("This label is ");
                                                l1.appendChild(theText);
                                                
                                                s1 = document.createElement('select');
                                                s1.setAttribute('class', 'fonted');
                                                s1.setAttribute('id', 'personal_select');

                                                theOption = document.createElement("OPTION");
                                                theText = document.createTextNode("for the "+"XXX_KIND_XXX");
                                                theOption.appendChild(theText);
                                                theOption.setAttribute("value",1);
                                                s1.appendChild(theOption);

                                                theOption = document.createElement("OPTION");
                                                theText = document.createTextNode("personal");
                                                theOption.appendChild(theText);
                                                theOption.setAttribute("value",2);
                                                s1.appendChild(theOption);

                                                s1.onchange = function () {
                                                    if (this.value == 1) {
                                                        set_style(document.getElementById('shared_label'),{display: 'none'});
                                                    } else {
                                                        set_style(document.getElementById('shared_label'),{display: 'inline'});
                                                    }
                                                }
                                                
                                                l1.appendChild(s1);
                                                p.appendChild(l1);
                                            }
                                            
                                            p = document.getElementById('options_row');
                                            l2 = document.createElement('label');
                                            l2.setAttribute('style', 'margin-left: 15px;');
                                            l2.setAttribute('id', 'shared_label');
                                            theText = document.createTextNode("Share this label ");
                                            l2.appendChild(theText);
                                            c1 = document.createElement('input');
                                            c1.setAttribute('type', 'checkbox');
                                            c1.setAttribute('id', 'shared_checkbox');
                                            l2.appendChild(c1);
                                            p.appendChild(l2);
                                            if (XXX_ADMIN_XXX) {
                                                set_style(l2,{display: 'none'});
                                            }
                                            create_condition_if();
                                            create_condition_fix();
                                            create_condition();
                                            });
                                        menu_add_label_container = document.createElement('ul');
                                        add_class(menu_add_label_container, 'label_item');
                                        menu_add_label_container.appendChild(menu_add_label)
                                        document.getElementById('menu_container_down').appendChild(menu_add_label_container);
                                        }
                                    });
                                
                                // this doesn't work!
                                $("a").click(function() {
                                    $("a").removeClass("clickeditem");
                                    $(this).addClass("clickeditem");
                                    });
                                                                
                                <!-- $('a.btn-ok, #dialog-overlay, #dialog-box').click(function () { -->
                                $('#Btn_labeldialog_close').click(function () {
                                    $('#dialog-overlay, #dialog-box').hide();
                                    if (window.forum){
                                        window.forum.destroy(); window.forum.stop_timer();
                                        }
                                    set_style(document.getElementById('posts_container'),{display: 'block'})
                                    
                                    return false;
                                    });

                                $('#Btn_labeldialog_addlabel').click(function () {
                                    var parent_id = '0';
                                    var name_label = $("#name_label").val();
                                    if (window.forum){
                                        window.forum.destroy(); window.forum.stop_timer();
                                        }
                                    if (name_label==''){
                                        //window.name_label_new = prompt("Please enter a name for the label","");
                                        alert('Please enter a label name.');
                                        return false;
                                    }
                                    //alert("->"+name_labe+"<-");
                                    //if(window.name_label_new === undefined){return false;}
                                    //else if (window.name_label_new == ''){return false;}
                                    //name_label = window.name_label_new;
                                    set_style(document.getElementById('posts_container'),{display: 'block'});
                                    var parent = new Object();
                                    for (var i in window.labels){
                                        if (window.labels[i].txt == $("#list_labels").val()){
                                            parent_id = i;
                                            parent = window.labels[i];
                                            }
                                        }
                                            
                                    var label2alert = {};
                                    label2alert.obj_id = source_id;
                                    label2alert.name = name_label;
                                    label2alert.nick = $("#description_label").val();
                                    label2alert.parent = parent_id;
                                    label2alert.color = document.getElementById('color1').value;
                                        
                                    /*
                                    // categories:
                                    if (document.labelcategory == 1) {
                                        label2laert.shared = 'shared';
                                        label2alert.owner = 'owner';
                                    } 
                                    // else if (){}
                                    */
                                    
                                    var rule=[];
                                    opt = document.getElementById('taglist').value;
                                    if(document.getElementById('optionsbutton').innerHTML == "more options..."){
                                        // no options
                                        rule=[];
                                    } else {
                                        // options maybe active
                                        
                                        // date field
                                        if (!isNaN(parseInt(document.getElementById('datetext').value)) || (document.getElementById('timelist').value != 25)){
                                            bool = document.getElementById('datetext').value == 'ture';
                                            date = new Date;
                                            if (!isNaN(parseInt(document.getElementById('datetext').value))) {
                                                date = Date(document.getElementById('datetext').value);
                                                }
                                            if (document.getElementById('timelist').value != 25){
                                                date.setHours(document.getElementById('timelist').value);
                                            }
                                            intgr = date.getTime()/1000;
                                            cond = {};
                                            cond.id = 5;
                                            cond.opt = opt;
                                            cond.params = [];
                                            cond.params[0] = intgr;
                                            cond.params[1] = bool;
                                            rule.push(cond);
                                            }
                    
                                        // comments field
                                        if (document.getElementById('hasattachments').checked){
                                            // bool = true;
                                            cond = {};
                                            cond.id = 4;
                                            cond.opt = opt;
                                            cond.params = [];
                                            // cond.params[0] = bool;
                                            rule.push(cond);
                                            }
                                            
                                         conddiv = document.getElementById('conditions');
                                         conditionsdiv=conddiv.getElementsByTagName('div');
                                         for (i=1;i<=conditionsdiv.length-1;i++){
                                             if (conditionsdiv[i-1].getElementsByTagName('input')[0].value != ''){
                                                 cond = {};
                                                 cond.id = conditionsdiv[i-1].getElementsByTagName('select')[0].value;
                                                 cond.opt = opt;
                                                 cond.params = [];
                                                 cond.params[0] = conditionsdiv[i-1].getElementsByTagName('input')[0].value;
                                                 if (cond.id == 31) {
                                                    cond.id = 3;
                                                    cond.params[1] = true;
                                                    } else if (cond.id == 32) {
                                                        cond.id = 3;
                                                        cond.params[1] = false;
                                                        } else {
                                                            cond.params[0] = parseInt(cond.params[0]);
                                                            cond.id = parseInt(cond.id);
                                                            }
                                                 rule.push(cond);
                                             }
                                         }
                    
                                    }
                                        
                                        // -> at the end, change the first opt to 0
                                        
									label2alert.rule = $.toJSON(rule);
                                        
                                    $.post("/create_label",label2alert,
                                    function(result) {
                                        
                                        if (result["type"]=="ok"){
                                            if (parent_id == '0'){
                                                window.labels[result["data"]] = create_label_iconed(name_label, result["data"], 'personal', function(){alert('click')});
                                                document.getElementById('lable_container_ul').appendChild(window.labels[result["data"]]);
                                                
                                                } else {
                                                window.labels[parent_id].add_child(name_label, result["data"], function(){alert('click')});
                                                }
                                            //$("#TEST_UL").append('<li><a href="#" title="' +$("#description_label").val() + '">' + $("#name_label").val() + '</a></li>');
                                            } else {
                                            alert("An error occured, no lable culd be made, please try again!")
                                           }
                                        });
                                    $('#dialog-overlay, #dialog-box').hide();
                                    return false;
                                });
                                    
                            });
                        } // End of DB connection and the Menu
                        
                    </script>
                    <a id="fb_connect_button" class="fb_button fb_button_medium" style="display:none"><span class="fb_button_text">Connect with Facebook</span></a>
                    <div id="forum_container">
                        <div id="dialog-box">
                            <div class="dialog-content">
                                <div id="dialog-message"></div>
                                <table width="100%" border="0" style="border-top: 1px solid rgb(204, 204, 204); padding-top: 5px; margin-top: 15px;">
                                    <tr>
                                        <!-- <td><a href="#" id="Btn_addrule" class="buttoninline">Add rule:</a></td> -->
                                        <td><a href="#" id="Btn_labeldialog_addlabel" class="buttoninline">+ Add</a></td>
                                        <td><a href="#" id="Btn_labeldialog_close" class="buttoninline">X Close</a></td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        
                        <div id="posts_container">
                            <a onclick="switch_posts_to_page(window.post_show.now_displaying + 1)" href="javascript:void(0)" style="float: left; padding-right: 5px;" class="button gray"><table style="border:none 0px;"><tbody><tr><td style="border:none 0px;background-color:transparent;color: rgb(0, 0, 0);">&#x25C0;</td></tr></tbody></table></a>
                            <a onclick="if (window.post_show.now_displaying > 1) {switch_posts_to_page(window.post_show.now_displaying-1)}else{switch_posts_to_page(0)}" href="javascript:void(0)" style="float: left; padding-right: 5px;" class="button gray"><table style="border:none 0px;"><tbody><tr><td style="border:none 0px;background-color:transparent;color: rgb(0, 0, 0);">&#x25BA;</td></tr></tbody></table></a>
                            <div id="posts"></div>
                        </div>
                        <div id="post_comment_container" style="display:none">
                            <a onclick="window.forum.destroy(); window.forum.stop_timer(); set_style(this.parentNode, {display:'none'}); set_style(document.getElementById('posts_container'),{display: 'block'})" href="javascript:void(0)" style="float: right; padding-right: 5px;" class="button gray"><table style="border:none 0px;"><tbody><tr><td style="border:none 0px;background-color:transparent;color: rgb(0, 0, 0);">Back to posts</td></tr></tbody></table></a>
                            <div id="post_comment">        
                            </div>
                        </div>
                    </div>
                    
                    
                </div>
            </div>
            <!-- end .container_12 -->
            
            
            
        </body>
    </html>
    
    
    
